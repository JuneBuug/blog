---
title   : 'JVMì˜ GC ì¢…ë¥˜ ì •ë¦¬ - G1GC ì™€ ZGCë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ' 
slug  : '/jvm-gc' 
layout  : wiki 
excerpt : 
date    : 2023-03-12 20:40:17 +0900
updated : 2023-03-12 20:40:41
tags    : 
- JVM
- GC
---



## ì„œë¡ 
[jvm ê³¼ ê·¸ ë©”ëª¨ë¦¬](https://junery.dev/jvm-basics) ì— ì´ì€ JVM ì˜ GC ì¢…ë¥˜ ì •ë¦¬ë‹¤. ì‚¬ì‹¤ ì´ë¯¸ ìŠ¤í”„ë§ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë„ìš¸ ë•Œì˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì£¼ì˜í•´ì„œ ë³´ë©´ GC ì˜ ì¢…ë¥˜ë¥¼ ëª…ì‹œí•´ì¤€ ê±¸ ë•Œë•Œë¡œ ë°œê²¬í•  ìˆ˜ ìˆëŠ”ë°, GC ì˜ ì¢…ë¥˜ë¥¼ ì•Œê³  ë³´ë©´ ê´œíˆ ë°˜ê°‘ê³  ì‹ ê¸°í•˜ê²Œëœë‹¤. ì˜¤ëŠ˜ì€ ì¼ë°˜ì ì¸ JVM GC ì¢…ë¥˜ë¥¼ ì •ë¦¬í•˜ë˜,   java 11 ì—ì„œ ë“±ì¥í–ˆë‹¤ëŠ” ë¹„êµì  ìµœì‹  GC (Â **ZGC**) ê¹Œì§€ ì•Œì•„ë³¸ë‹¤.


## GC ë¥¼ ì™œ í• ê¹Œìš”? 
Garbage Collection ì€ ì™œ í• ê¹Œ? Garbage Collectionì€ ê¸°ë³¸ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ìƒì— ë”ì´ìƒ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê°ì²´ê°€ ë‚¨ì•„ì„œ ìë¦¬ ì°¨ì§€í•˜ëŠ” ì¼ì„ ë§‰ëŠ” ì¼ì´ë‹¤. C ì™€ ê°™ì€ ì–¸ì–´ì—ì„œëŠ” ëª…ì‹œì ìœ¼ë¡œ (`free`!) í• ë‹¹í–ˆë˜ ìë¦¬ë¥¼ ì§€ì›Œì£¼ì§€ë§Œ, ìë°”ì—ì„œëŠ” Garbage Collect**or** ë¼ëŠ” ì¡´ì¬ë¥¼ ë”°ë¡œ ë‘¬ì„œ ìë™ ì²­ì†Œë¥¼ í•˜ë„ë¡ í•œ ê²ƒ! ğŸ§¹

ì´ëŸ° ìë™ ì²­ì†Œ ì‹œìŠ¤í…œì„ ë„ì…í•  ë•ŒëŠ” ë‹¤ì–‘í•œ ì‹œê°ì´ ìˆì—ˆë‹¤. ìê³ ë¡œ ìë™ ì²­ì†ŒëŠ” ë¹„íš¨ìœ¨ì ì´ë©°, í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ í•´ì œí•˜ëŠ”ê²Œ ì í™•í•´ì„œ íš¨ìœ¨ì ì´ì§€! ğŸ¥¸ ë¼ëŠ” ì‹œê°ë„ ìˆì—ˆê³ . ì´ ì‹œê°ì€ ì¼ë¶€ ë§ëŠ” ë§ì´ê¸°ë„ í•˜ë©°, ê·¸ë˜ì„œ ì‹¤ì‹œê°„ì„±ì´ ì¤‘ìš”í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” Garbage Collector ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì§ì ‘ ë©”ëª¨ë¦¬ë¥¼ ì œì–´í•˜ëŠ” ë°©ì‹ì˜ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¥¼ ì„ í˜¸í•˜ê¸°ë„ í•œë‹¤. 

ê·¸ëŸ¼ì—ë„ Garbage Collector ë¥¼ ì¨ì•¼í•˜ëŠ” ì´ìœ ?  ìë™ìœ¼ë¡œ í• ë‹¹ì„ í•´ì œí•´ì£¼ëŠ” GC ëŠ” í”„ë¡œê·¸ë˜ë¨¸ê°€ ë©”ëª¨ë¦¬ ê´€ë¦¬ì— ì‹ ê²½ì“°ì§€ ì•Šê³ , ê°€ë…ì„±ì„ ë†’ì´ë©°, ê°œë°œ ì‹œê°„ê³¼ ë¹„ìš©ì„ ì¤„ì–´ë“¤ê²Œ í•´ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. (ê³¨ì¹˜ ì•„í”ˆ ë©”ëª¨ë¦¬ ê´€ë¦¬ëŠ” GC ê°€ í•´ê²°í–ˆìœ¼ë‹ˆ ì•ˆì‹¬í•˜ë¼êµ¬!ğŸ¦) ë”ë¶ˆì–´ ëª…ì‹œì ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê´€ë¦¬ë¥¼ í•˜ëŠ” ê±´ .. íœ´ë¨¼ ì—ëŸ¬ë¥¼ í†µí•´ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” í™•ë¥ ì´ ë†’ë‹¤. - ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í™•ë¥  ì¦ê°€ -

ì´í›„ì˜ GC ë¼ëŠ” ë‹¨ì–´ëŠ” collector (ì£¼ì²´)ì™€ collect(í–‰ìœ„) ë¥¼ ë¬¸ë§¥ì— ë”°ë¼ ì§€ì¹­í•  í™•ë¥ ì´ ë†’ë‹¤. 

## GC ì•Œê³ ë¦¬ì¦˜ 

GC ëŠ” ë‹¤ì–‘í•œ ì–¸ì–´ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆê³ , GC ìì²´ë¥¼ ê°œë°œí•˜ê¸° ìœ„í•œ ì•Œê³ ë¦¬ì¦˜ë„ ë‹¤ì–‘í•˜ê²Œ ì œì•ˆë˜ì–´ì™”ë‹¤. JVM ì§„ì˜ì—ì„œëŠ” ì—¬ê¸°ì„œ íš¨ìœ¨ì ì´ë¼ê³  ìƒê°í•œ ì•Œê³ ë¦¬ì¦˜ì„ ì±„íƒí•´ì„œ GC ë¥¼ ë§Œë“¤ì—ˆê³ , ë” ë‚˜ì€ ë°©ë²•ì´ ìˆë‹¤ë©´ ìƒˆë¡œìš´ GC ë¥¼ ë§Œë“¤ì–´ì„œ ìŠ¤ì„ì© ë‹¤ìŒ JDK ë°œí‘œì— ë„£ëŠ” ë“±ì˜ ì¼ì„ í•˜ê³  ìˆë‹¤. 


GC ë¥¼ ë‚´ê°€ ë§Œë“ ë‹¤ê³  ìƒê°í•´ë³´ì. ê¸°ë³¸ì ì¸ ìŠ¤í™ì€ 'ì°¸ì¡°ê°€ í•˜ë‚˜ë„ ì—†ëŠ”' ê°ì²´ë¥¼ ì•Œì•„ë‚´ê³  ê·¸ê±¸ ì§€ìš°ëŠ” ê²ƒì´ë‹ˆê¹Œ, ê°€ì¥ ë¨¼ì € 'ì°¸ì¡°ì˜ ê°¯ìˆ˜ë¥¼' ì„¸ë³´ìëŠ” ê²°ë¡ ì— ë‹¤ë‹¤ë¥¼ ê²ƒì´ë‹¤. 
ê·¸ëŸ° ë§ˆìŒì—ì„œ ë“±ì¥í•œê²Œ `Reference Counting` ì•Œê³ ë¦¬ì¦˜ì´ë‹¤.
### Reference Counting ì•Œê³ ë¦¬ì¦˜


![reference-counting](./reference.png)
- ì‰½ê³ , êµ¬í˜„í•˜ê¸°ë„ ì¢‹ë‹¤ 
- GC ê°€ í”„ë¡œê·¸ë¨ ì‚¬ì´ì— "ë¼ì›Œë„£ì–´"(interleave) ì§€ë¯€ë¡œ, ê²°ê³¼ì ìœ¼ë¡œ í”„ë¡œê·¸ë¨ê³¼ ë™ì‹œì— ìˆ˜í–‰ëœë‹¤. í•œì •ëœ ë¶€ë¶„ì— ëŒ€í•´ì„œë§Œ ì‹¤í–‰ì´ ë˜ë‹ˆê¹Œ ì •ì§€ì‹œê°„ì´ ë§¤ìš° ì§§ë‹¤. ê·¸ëŸ¬ë‹ˆ ì‘ë‹µì‹œê°„ì´ ì•„ì£¼ ì¤‘ìš”í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ìœ ìš©!
- ë§¤ë²ˆ ê°ì²´ê°€ ì°¸ì¡°ë˜ê±°ë‚˜ / ì°¸ì¡° í•´ì œë ë•Œë§ˆë‹¤ ìˆ˜í–‰ëœë‹¤.

- ìœ„ ê·¸ë¦¼ê³¼ ê°™ì´ ìˆœí™˜ì°¸ì¡°ê°€ ì¼ì–´ë‚˜ë©´ ì•Œì•„ë³¼ ìˆ˜ ì—†ë‹¤ëŠ” í¬ë¦¬í‹°ì»¬í•œ ë‹¨ì ì´ ìˆë‹¤.
- counter ë¥¼ ì €ì¥í•˜ê¸°ìœ„í•œ ì¶”ê°€ì ì¸ ì €ì¥ê³µê°„ì´ í•„ìš”í•˜ë‹¤. 


### Mark-and-Sweep
ì´ì™€ ê°™ì´, ì°¸ì¡°ë¥¼ ì„¸ëŠ” ì•Œê³ ë¦¬ì¦˜ì€ ë‹¨ì ë„ ìˆê¸°ë•Œë¬¸ì— Mark-and-Sweep ì´ë¼ëŠ” ì•Œê³ ë¦¬ì¦˜ì´ ë“±ì¥í–ˆë‹¤.
ë²ˆì—­í•˜ë©´ `ì²´í¬í•˜ê³ -ê·¸ë‹¤ìŒ-ì“¸ì–´ë²„ë¦¼` ì •ë„ ë˜ë‹ˆ, ì²´í¬í•˜ëŠ” ê³¼ì •ê³¼ ë©”ëª¨ë¦¬ í•´ì œ ê³¼ì •ì´ ë¶„ë¦¬ë˜ì–´ìˆë‹¤ëŠ” ëŠë‚Œì´ ë¬¼ì”¬ ë‚œë‹¤. Reference counting ê³¼ ë‹¬ë¦¬, íŠ¹ì • ì£¼ê¸°ë§ˆë‹¤ ì‹¤í–‰ëœë‹¤. 


ì•Œê³ ë¦¬ì¦˜
- ì²« ë‹¨ê³„ : ë£¨íŠ¸ì—ì„œ ì‹œì‘í•´ì„œ, ë©”ëª¨ë¦¬ ê·¸ë˜í”„ë¥¼ ì­‰ ìˆœí™˜í•˜ë©´ì„œ ë”°ë¼ê°„ë‹¤. ë„ì°©í•  ìˆ˜ ìˆì—ˆë˜ ê°ì²´ëŠ” ëª¨ë‘ ë§ˆí‚¹í•œë‹¤. 
- ë‘ë²ˆì§¸ ë‹¨ê³„: ë©”ëª¨ë¦¬ë¥¼ ì“¸ì–´ë²„ë ¤(!) ì„œ ë§ˆí‚¹ì´ ì—†ëŠ” ê³µê°„ì€ ë‹¤ ì§€ì›Œë²„ë¦°ë‹¤. 

**ì¥ì **
- ëª¨ë“  ë©”ëª¨ë¦¬ ì—°ì‚°ì— ë¶™ì§€ ì•Šê³  ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. (ìœ„ì˜ Reference Countingê³¼ì˜ ë¹„êµ)

**ë‹¨ì **
- ë©”ëª¨ë¦¬ì˜ ëª¨ë“  ì˜ì—­ì„ ê¼¼ê¼¼íˆ í‰ê°€í•´ì•¼í•˜ë¯€ë¡œ ì‹œê°„ì´ ë§ì´ ë“ ë‹¤. 
- ë©”ëª¨ë¦¬ë¥¼ ì“¸ì–´ë²„ë¦° ê³µê°„ì€ ë¹„ì›Œì§€ë¯€ë¡œ, ë©”ëª¨ë¦¬ ì‚¬ì´ì— ê°­ì´ ìƒê¸´ë‹¤. (ì¡°ê°ì¡°ê°~)

### Mark-Compact
ë°”ë¡œ ìœ„ì—ì„œ ë§í•œ Mark-and-Sweep ì•Œê³ ë¦¬ì¦˜ì˜ ë‹¨ì ì„ ë°”ë¡œ ê°œì„ í•œ ê²ƒ. Compact ë¼ëŠ” ë‹¨ê³„ë¥¼ ë‘¬ì„œ ê³µê°„ ì¤„ì´ê¸°ë¥¼ ì‹œë„í•œ ê²ƒì´ë‹¤. 

**ì•Œê³ ë¦¬ì¦˜**
- Mark-Sweep ì²˜ëŸ¼ ë§ˆí¬ ë‹¨ê³„ë¥¼ ê±°ì¹œë‹¤.
- ì£½ì€ ê°ì²´ë¥¼ ì“¸ì–´ë²„ë¦¬ëŠ” ëŒ€ì‹ , ì‚´ì•„ìˆëŠ” ê°ì²´ê°€ ë©”ëª¨ë¦¬ ì˜ì—­ ì²«ë²ˆì§¸ë¡œ ë°€ë¦°ë‹¤. ë‚˜ë¨¸ì§€ ë©”ëª¨ë¦¬ëŠ” ë‹¤ ì§€ì›Œë²„ë¦°ë‹¤. 

**ì¥ì **
- Mark-Sweep ì—ì„œ ê²½í—˜í–ˆë˜ ë©”ëª¨ë¦¬ íŒŒí¸í™”ê°€ ì—†ì–´ì§„ë‹¤. 
- GC ì „ì— ë©”ëª¨ë¦¬ ì£¼ì†Œê°€ ë†’ìœ¼ë©´ , GC ì´í›„ì—ë„ ë†’ë‹¤. (ì•½ê°„... ì•ˆì •ì •ë ¬ì²˜ëŸ¼) - ë°°ì—´ê³¼ ê°™ì€ ìë£Œêµ¬ì¡°ë¥¼ ë‹¤ë£°ë•ŒëŠ” ì´ê²Œ ì•„ì£¼ ì¤‘ìš”í•œ íŠ¹ì„±ì„ 

**ë‹¨ì **
- ì‹œê°„.. ì‹œê°„! Mark-Sweepë³´ë‹¤ë„ ì˜¤ëœ ì‹œê°„ì´ ê±¸ë¦°ë‹¤. ë‹¹ì—°íˆ ì„±ëŠ¥ë„ ì•ˆì¢‹ë‹¤. 


### Generational GC
GC ì˜ ë³€í™”ëŠ” Mark-Sweep ì‚¬ì´ì—ë„ ë§ì•˜ë‹¤.  `copying` ì´ë‚˜ `incremental` gc ë¼ëŠ” ì•Œê³ ë¦¬ì¦˜ë„ ìˆì—ˆì§€ë§Œ, ì¼ë‹¨ í•µì‹¬ì ì¸ ë¶€ë¶„ì¸ Generational GC  ë¥¼ ì„¤ëª…í•œë‹¤. 

ê°„ë‹¨í•œ GC ì•Œê³ ë¦¬ì¦˜ì˜ í•œê³„ëŠ” ì‹œìŠ¤í…œì´ í™ì— ìˆëŠ” ë°ì´í„°ë¥¼ ì¸¡ì •í•´ì•¼í•œë‹¤ëŠ” ì ì´ì—ˆë‹¤. ë‹¹ì—°íˆ ì‹¤í–‰ì‹œê°„ì€ ëŠ˜ì–´ë‚˜ëŠ” ê²ƒì´ì—ˆê³ . [jvm ê³¼ ê·¸ ë©”ëª¨ë¦¬](https://junery.dev/jvm-basics) ì—ì„œë„ ì–¸ê¸‰í–ˆì§€ë§Œ íŠ¹ì • ì—°êµ¬ê°€ ëŒ€ë¶€ë¶„ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” ë§¤ìš° ì§§ì€ ì‹œê°„ë™ì•ˆë§Œ ìƒì¡´í•œë‹¤ëŠ” ê°€ì„¤ì„ ì„¸ì› ë‹¤. (weak generational hypothesis) ì—¬ê¸°ì„œ ì£¼ëª©í•´ì•¼í•  ì ì€, ìš°ë¦¬ê°€ young ì˜¤ë¸Œì íŠ¸ì— ì§‘ì¤‘í•˜ê³  old ì˜¤ë¸Œì íŠ¸ë¥¼ ì˜ ì•ˆê±´ë“œë¦°ë‹¤ë©´, ë¶„ì„í•´ì•¼í•˜ëŠ” ì–‘ì´ ìƒë‹¹íˆ ì¤„ì–´ë“ ë‹¤ëŠ” ì ì´ë‹¤.

ì´ëŸ¬í•œ ì ‘ê·¼, ì¦‰ old ì˜¤ë¸Œì íŠ¸ë¥¼ ë¶„ì„í•˜ì§€ ì•Šê²Œ í•˜ëŠ” ë°©ë²•ì€ `Generational GC` ë¼ê³  ë¶ˆë¦°ë‹¤. ì–´ë””ì„œ ë§ì´ ë“¤ì–´ë³¸ ê²ƒ ê°™ë‹¤ - JVM heap ìì²´ê°€ generation ë³„ë¡œ ë˜ì–´ìˆìœ¼ë‹ˆê¹Œ ì¢€ ìµìˆ™í•˜ë‹¤ ì‹¶ë‹¤.

![generational](./generational.png)

**ì•Œê³ ë¦¬ì¦˜**
- ì„¸ëŒ€ ë¼ê³  ë¶ˆë¦¬ëŠ” ë‘ê°œ ì´ìƒì˜ ê³µê°„ìœ¼ë¡œ í™ì„ ë‚˜ëˆˆë‹¤. 
- ì²˜ìŒ í• ë‹¹ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ë“¤ì€ ë¬´ì¡°ê±´ ì œì¼ ì–´ë¦° ì„¸ëŒ€ì— í• ë‹¹ëœë‹¤. 
- gc ì•Œê³ ë¦¬ì¦˜ì€ í•­ìƒ ì œì¼ ì–´ë¦° ì„¸ëŒ€ë¥¼ ì œì¼ ìì£¼ ìŠ¤ìº”í•˜ê³ , ... ë” ì˜¤ë˜ëœ ì„¸ëŒ€ëŠ” ì ê²Œ ìŠ¤ìº”í•œë‹¤. 

**ì–´ë ¤ìš´ ì **

- ì´ ì•Œê³ ë¦¬ì¦˜ì´ ì‘ë™í•˜ê¸° ìœ„í•´ì„œëŠ”, ì˜¤ë˜ëœ ì„¸ëŒ€ë¥¼ ìˆ˜ì§‘í•˜ì§€ ì•Šê³ ë„ ì–´ë¦° ì„¸ëŒ€ë¥¼ ìˆ˜ì§‘í•  ìˆ˜ ìˆì–´ì•¼í•œë‹¤. 
	- ì—¬ê¸°ì„œ ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ë° ğŸ¤” ë§Œì•½ì— ì˜¤ë˜ëœ ì„¸ëŒ€ì—ì„œ ì–´ë¦° ì„¸ëŒ€ìª½ì— í¬ì¸í„°ê°€ ìˆë‹¤ë©´, ì–´ë¦° ì„¸ëŒ€ìª½ì€ ë‹¹ì—°íˆ ì‚´ì•„ìˆëŠ” ê°ì²´ë‹¤. 
	- ê·¸ëŸ¬ë¯€ë¡œ ì„¸ëŒ€ ê°„ì— í¬ì¸í„°/ì°¸ì¡°ê°€ ìˆëŠ”ì§€ í•­ìƒ ì²´í¬í•´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤. 
	- ì´ëŸ° í¬ì¸í„°ê°€ ë°œìƒí•  ìƒí™©ì€ ì•„ë˜ ë‘ ì¼€ì´ìŠ¤ì¼ í…ë°..
		- í¬ì¸í„°ë¥¼ ë“¤ê³  ìˆëŠ” ê°ì²´ë§Œ ì˜¤ë˜ëœ ì„¸ëŒ€ë¡œ ì§„ê¸‰í•´ë²„ë¦°ë‹¤! (promoted to old generation)
		- í¬ì¸í„°ê°€ ë°”ë¡œ ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ì–´ë²„ë¦°ë‹¤!
	- ì²«ë²ˆì§¸ ìƒí™©ì—ì„œëŠ” ì„¸ëŒ€ ê°„ í¬ì¸í„°ë¥¼ ì €ì¥í•˜ê¸° ì‰½ì§€ë§Œ, ë‘ë²ˆì§¸ëŠ” ì–´ë µë‹¤. 

ê·¸ë˜ë„ ì „ë°˜ì ìœ¼ë¡œ, generational collectionì´ ëŒ€ë¶€ë¶„ í”„ë¡œê·¸ë¨ì—ì„œ gcì˜ ì„±ëŠ¥ì´ í–¥ìƒë˜ëŠ”ê±´ ë¶„ëª…í•˜ë‹¤. 


## JVM ì´ ì±„íƒí•˜ê³  ìˆëŠ” GC 

JVM 9ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ì†Œê°œí•˜ê³ , JVM 11 ì—ì„œ ZGC ê°€ ì†Œê°œëë‹¤.
ë‚˜ì˜ ê´€ì‹¬ì‚¬ëŠ” G1ê³¼ ZGC ì´ê¸°ë•Œë¬¸ì—, ì´ë¥¼ ì¤‘ì ì ìœ¼ë¡œ ì‚´í´ë³´ê³  ë‚˜ë¨¸ì§€ëŠ” ê°„ë‹¨í•˜ê²Œ ë„˜ì–´ê°€ê² ë‹¤.

- Serial 
  - Garbage Collectë¥¼ ì‹±ê¸€ ìŠ¤ë ˆë“œë¡œ ì§„í–‰í•˜ëŠ” GC. ìŠ¤ë ˆë“œ ê°„ ì˜¤ë²„í—¤ë“œê°€ ì—†ê¸°ë•Œë¬¸ì— ì´ì ì´ ìˆë‹¤. í•˜ë‚˜ì˜ í”„ë¡œì„¸ì„œë§Œì„ ì‚¬ìš©í•˜ëŠ” ë¨¸ì‹ ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìœ¼ë©° (ë©€í‹° í”„ë¡œì„¸ì„œì˜ ì´ì ì„ ì·¨í•  ìˆ˜ ì—†ì–´ì„œ), jvm ì˜µì…˜ìœ¼ë¡œëŠ” `-XX:+UseSerialGC` ì„ ì‚¬ìš©í•˜ë©´ ì¨ë³¼ ìˆ˜ ìˆë‹¤.
- Parallel 
	- Serial ì²˜ëŸ¼ Generational Collectorì´ì§€ë§Œ, ì´ë¦„ì—ì„œ ì•Œ ìˆ˜ ìˆëŠ” ê²ƒì²˜ëŸ¼ ë©€í‹° ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•´ì„œ ì²˜ë¦¬ëŸ‰ì„ ë†’ì¸ë‹¤ëŠ” ì ì´ ë‹¤ë¥´ë‹¤. `-XX:+UseParallelGC` ë¡œ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆë‹¤.
- Concurrent-Mark-and-Sweep
	- JDK 9 ë¶€í„°ëŠ” ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ì•ŠëŠ” ì¢…ë¥˜. Â `-XX:+UseConcMarkSweepGC` ë¡œ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆìœ¼ë©°, GC ì˜ ì •ì§€í˜„ìƒ (stop-the-world) ë¥¼ ì¤„ì´ëŠ” ëŒ€ì‹  ì„œë²„ì˜ ìì›ì„ ë” ê°€ì ¸ê°€ëŠ” ì¢…ë¥˜ë‹¤.
- G1 (Garbage First) GC
	- ë©”ëª¨ë¦¬ê°€ í¬ê³  ë©€í‹°í”„ë¡œì„¸ì„œì¸ ì„œë²„ë“¤ì„ ìœ„í•œ ì¢…ë¥˜. ì •ì§€í˜„ìƒì˜ ì‹œê°„ì„ ì¤„ì´ë©´ì„œë„ ì²˜ë¦¬ëŸ‰ì„ ëŠ˜ë¦°ë‹¤ëŠ”, ë§ë„ ì•ˆë˜ì–´ë³´ì´ëŠ” ëª©í‘œë¥¼ ë‹¬ì„±í–ˆë‹¤.. ê³  í•œë‹¤. `-XX:+UseG1GC` ë¡œ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆë‹¤.

- ZGC 
	- Z GC ëŠ” í™•ì¥ê°€ëŠ¥í•œ ì €ì§€ì—° gcë‹¤. ZGC ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤ë ˆë“œì˜ ë™ì‘ì„ ë§‰ì§€ ì•Šìœ¼ë©´ì„œë„, ë¹„ì‹¼ ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•œë‹¤. ZGC ëŠ” 10ms ë¯¸ë§Œì˜ ì§€ì—°ì´ í•„ìš”í•˜ê³ , heap ì´ í° (ìˆ˜ í…Œë¼ë°”ì´íŠ¸) ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤.  Â `-XX:+UseZGC` ì˜µì…˜ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.


### G1 GC 
G1ì€ Garbage First ë¥¼ ì¤„ì—¬ì„œ G1ì´ë‹¤. ê·¸ë¥¼ ì„¤ëª…í•˜ëŠ” ì²« ë¬¸ì¥ë¶€í„° ì¸ìƒì ì´ë‹¤. 

> Â a generational, incremental, parallel, mostly concurrent, stop-the-world, and evacuating garbage collector which monitors pause-time goals in each of the stop-the-world pauses.

ì¦‰  ìœ„ì—ì„œ ì‚´í´ë³¸ generational ì˜ ê°œë…, (ì•ˆì‚´í´ë³¸) incremental gc ì•Œê³ ë¦¬ì¦˜ì„ ì°¨ìš©í–ˆì„ ë¿ ì•„ë‹ˆë¼ ë™ì‹œì„±ì„ ë³´ì¥í•˜ê³  stop-the-world ì˜ ê°œë…ì´ ìˆëŠ” GC  ë‹¤. 

- ë‹¤ë¥¸ GC ì²˜ëŸ¼, ì„¸ëŒ€ë³„ë¡œ í™ì„ ë‚˜ëˆ ì„œ ì‚¬ìš©í•˜ê³ , ë©”ëª¨ë¦¬ì˜ ê³µê°„ ì°½ì¶œí•˜ëŠ” ì „ëµì´ young ì„¸ëŒ€ì— ì§‘ì¤‘ë˜ì–´ìˆë‹¤. 
- ë©”ëª¨ë¦¬ ê³µê°„ ì°½ì¶œ ê³¼ì •ì´ ë‚˜ëˆ ì ¸ìˆê³  (in steps) ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤. (in parallel)
- jdk 9ë¶€í„°ëŠ” ê¸°ë³¸ GCê°€ ëë‹¤. https://openjdk.org/jeps/248
- ì‹¤ì‹œê°„ collectorê°€ ì•„ë‹ˆì–´ì„œ, stop-the-world ê³¼ì •ì„ ìµœëŒ€í•œ ì¤„ì´ë ¤ê³  ë…¸ë ¥í•˜ê¸´í•˜ì§€ë§Œ ë°œìƒí•œë‹¤.

G1 GC ëŠ” í™ì„ ë‚˜ëˆ„ëŠ” ê°œë…ì´ ì¡°ê¸ˆ íŠ¹ì´í•˜ë‹¤. ì—¬ì „íˆ ì„¸ëŒ€ ê°œë…ì€ ì‚¬ìš©í•˜ì§€ë§Œ ê· ì¼í•œ í¬ê¸°ì˜ heap ì¡°ê°ìœ¼ë¡œ ë‚˜ëˆ ì ¸ìˆë‹¤.

![g1](./g1.png)

**G1 ì˜ ë‘ ê°€ì§€ phase**
G1ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‘ phaseë¥¼ ë°˜ë³µí•œë‹¤. 

![oracle javase11 ê³µì‹ë¬¸ì„œ](https://docs.oracle.com/en/java/javase/11/gctuning/img/jsgct_dt_001_grbgcltncyl.png)
- young-only 
- space-reclamation (ë©”ëª¨ë¦¬ ê³µê°„ ì°½ì¶œ)

young-only ë‹¨ê³„ì—ì„œëŠ” old ì„¸ëŒ€ë¡œ ë„˜ì–´ê°ˆë§Œí•œ ë†ˆë“¤ì„ ê³ ë¥´ê³  ì§„ê¸‰ì‹œí‚¤ëŠ” ì¼ë°˜ì ì¸ê³¼ì •ìœ¼ë¡œ ì‹œì‘ëœë‹¤. ë§Œì•½ old ì„¸ëŒ€ì˜ ê³µê°„ì´ íŠ¹ì • ì¡°ê±´ì„ ë„˜ê¸°ë©´, ì¼ë°˜ì ì¸ ê³¼ì •ì´ ì•„ë‹ˆë¼ `Concurrent Start young collection` ì´ë¼ëŠ” ì´ë¦„ì˜ ê³¼ì •ì´ ì‹œì‘ëœë‹¤. 
 - concurrent start: ì´ ê³¼ì •ì€ ì¼ë°˜ê³¼ì •ê³¼ ë¹„ìŠ·í•˜ê¸´í•œë°,  ì•„ì§ ì‚´ì•„ìˆëŠ” ê°ì²´ë“¤ì— ëŒ€í•œ ë§ˆí‚¹ì´ ì‹œì‘ëœë‹¤. ë§ˆí‚¹ì€ remark ì™€ cleanup ì´ë¼ëŠ” ë‘ê°œì˜ stop-the-world ì •ì§€ë¡œ ëë‚œë‹¤. 
 - remark: ì´ ê³¼ì •ì€ ë§ˆí‚¹ì„ ì¢…ë£Œí•˜ê³ , ì „ì²´ í™ì— ëŒ€í•´ì„œ ì°¸ì¡°ë¥¼ ì²˜ë¦¬í•˜ê³  í´ë˜ìŠ¤ ì–¸ë¡œë”©ì„ ìˆ˜í–‰í•˜ê³ , ì™„ì „íˆ ë¹ˆ ê³µê°„ì„ ì°½ì¶œí•˜ê³  ë‚´ë¶€ ë°ì´í„° êµ¬ì¡°ë¥¼ ì¹˜ìš´ë‹¤. remark ì™€ cleanup ì‚¬ì´ì— g1ì€ old ì—ì„œ ë©”ëª¨ë¦¬ ê³µê°„ì„ ì¢€ë” ê°€ì ¸ì˜¬ ìˆ˜ ìˆì„ì§€ ì •ë³´ë¥¼ ê³„ì‚°í•œë‹¤. 
 - cleanup: ì´ ê³¼ì •ì€ ë©”ëª¨ë¦¬ ê³µê°„ ì°½ì¶œ (space-reclamation) ê³¼ì •ì„ í• ì§€ ë§ì§€ ê²°ì •í•œë‹¤. í•˜ê¸°ë¡œ ê²°ì • ëì„ ê²½ìš°, young-only ë‹¨ê³„ëŠ” ì¢…ë£Œëœë‹¤. 

ë©”ëª¨ë¦¬ ê³µê°„ ì°½ì¶œ(space-reclamation) ë‹¨ê³„ : ì´ ë‹¨ê³„ëŠ” young ì˜ì—­ ë¿ ì•„ë‹ˆë¼ old ì˜ì—­ì˜ gcë„ í¬í•¨í•œë‹¤. ë©”ëª¨ë¦¬ ê³µê°„ ì°½ì¶œì€ G1ì´ íŒë‹¨í•˜ê¸°ì— old ì˜ì—­ì—ì„œ gcí•˜ëŠ”ê²Œ ë…¸ë ¥ì— ë¹„í•´ ì¶©ë¶„í•œ ê³µê°„ì´ ì•ˆë‚˜ì˜¨ë‹¤ê³  ìƒê°í•˜ë©´ ì¢…ë£Œëœë‹¤. (ã…‹ã…‹)


### ZGC 
ì´ë¦„ì´ í•˜ë„ ì´ìƒí•´ì„œ Zê°€ ë¬´ìŠ¨ ëœ»ì¸ì§€ ì°¾ì•„ë´¤ê³  openjdk ì˜ wikiì˜ FAQ ì—ì„œ ë‹µì´ ì‰½ê²Œ ë‚˜ì™”ë‹¤. 

> It doesn't stand for anything, ZGC is just a name. It was originally inspired by, or a homage to, ZFS (the filesystem) which in many ways was revolutionary when it first came out.

ì•„ë¬´ ì´ë¦„ë„ ì•„ë‹ˆê³ , ë‚˜ì˜¬ë•Œë¶€í„° ì™„ì „ í˜ëª…ì ì´ì—ˆë˜ ZFS ì—ì„œ ì˜ê°ì„ ë°›ì•˜ë‹¤ê³  í•œë‹¤. 
JDK 11ì—ì„œ ì‹¤í—˜ì ì¸ í”¼ì²˜ë¡œ ë“¤ì–´ì™”ê³ , JDK15ì—ì„œëŠ” ìƒìš© ê°€ëŠ¥í•œ ìƒíƒœë¡œ ë‚˜ì™”ë‹¤. 


G1 GC ì²˜ëŸ¼, ì—¬ê¸°ì—ë„ íŠ¹ì„±ì´ ìˆëŠ”ë° 
-   Concurrent (ë™ì‹œì„±ì´ ìˆê³ )
	- ìë°” ìŠ¤ë ˆë“œê°€ ëŒì•„ê°€ëŠ” ë™ì•ˆ ë™ì‹œì— GC ë¥¼ ì§„í–‰í•˜ê³ 
- Tracing
	- ì˜¤ë¸Œì íŠ¸ ê·¸ë˜í”„ë¥¼ ì¶”ì í•˜ëŠ” í˜•íƒœë¥¼ ë„ê³ 

-   Compacting 
	- ë©”ëª¨ë¦¬ íŒŒí¸í™”ë¥¼ ë§‰ê¸° ìœ„í•œ ë©”ëª¨ë¦¬ ì»´íŒ©ì…˜ ê³¼ì •ì´ ìˆë‹¤
- Single Generation
	- í˜„ì¬ë¡œì„œëŠ” Single Generation (!!)ì´ë¼ê³  í•œë‹¤.
-   Region-based 
	- G1 ì²˜ëŸ¼ heapì„ ì‘ê²Œ ë‚˜ëˆ„ëŠ” region í˜•íƒœì˜ heap êµ¬ì¡°ë¥¼ ê°€ì§„ë‹¤.
-   NUMA-aware
	- í”„ë¡œì„¸ìŠ¤ì—ê²Œ ë¡œì»¬ ë©”ëª¨ë¦¬ ì•¡ì„¸ìŠ¤ê°€ ë¡œì»¬ì´ ì•„ë‹Œ ë©”ëª¨ë¦¬ ì•¡ì„¸ìŠ¤ë³´ë‹¤ ë¹ ë¥´ë‹¤.
-   Using colored pointers
-   Using load barriers
	- ë™ì‹œì„±ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•œ ë‘ê°€ì§€ ë„êµ¬ì„.

ZGC ì˜ ì •ì§€ì‹œê°„ì€ O(1) ë¡œ, ìƒìˆ˜ì‹œê°„ì´ë¯€ë¡œ heap size, thread ì˜ ìˆ˜ ëª¨ë‘ ìƒê´€ì—†ë‹¤ê³  í•œë‹¤. 

![zgc](./zgc-phase.png)

ZGC ë°œí‘œ ì˜ìƒì— ë”°ë¥´ë©´, ë‹¤ìŒê³¼ ê°™ì€ phaseë¥¼ ì§€ë‚˜ë©´ì„œ GC ê°€ ì§„í–‰ëœë‹¤ê³  í•œë‹¤. 

- pause mark 
	- thread stackì„ ìŠ¤ìº”í•¨. 
	- ì‹¤ì œë¡œ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•´ì„œ ë§ˆí‚¹í•˜ê¸° ì‹œì‘í•¨ 
- pause mark ì¢…ë£Œ 
	- ë™ê¸°í™” ë‹¨ê³„, ì–´ë–¤ ì˜¤ë¸Œì íŠ¸ê°€ garbageê³  ì•„ë‹Œì§€ íŒŒì•… ì™„ë£Œ
	- ì°¸ì¡°ë“¤ì„ ì²˜ë¦¬í•˜ê³ , stringê³¼ ê°™ì€ weak rootë¥¼ ì œê±°í•œë‹¤. 
	- ê·¸ë¦¬ê³  ì–´ë””ë¥¼ ì •ë¦¬í•´ì•¼ ê°€ì¥ í° ë©”ëª¨ë¦¬ ê³µê°„ì„ ì–»ì„ ìˆ˜ ìˆëŠ”ì§€ ì²´í¬í•œë‹¤. 
- pause relocation 
	- ì‹¤ì œë¡œ heap ì„ ì •ë¦¬í•˜ê³  compact ê³¼ì •ì„ ê±°ì¹œë‹¤. 






## ì°¸ì¡° 
- https://rebelsky.cs.grinnell.edu/Courses/CS302/99S/Presentations/GC/

- https://docs.oracle.com/javase/9/gctuning/available-collectors.htm#JSGCT-GUID-45794DA6-AB96-4856-A96D-FDE5F7DEE498

- https://docs.oracle.com/en/java/javase/11/gctuning/garbage-first-g1-garbage-collector1.html#GUID-CE6F94B6-71AF-45D5-829E-DEADD9BA929D

- https://www.youtube.com/watch?v=OcfvBoyTvA8

- https://www.youtube.com/watch?v=kF_r3GE3zOo