---
title   : '소나큐브 log4j 취약점 fix'  
slug  : '/sonar-log4j-fix'
layout  : wiki 
excerpt : '혹시 모르니까..' 
date    : 2021-12-13 12:49:32 +0900
updated : 2021-12-13 12:55:48
tags    : 
---

## log4j 취약점 문제 
후술 예정 

## sonarqube fix 

sonarqube 측에서는 큰 문제는 없다고 생각하지만, 혹시 모르니 옵션을 넣으면 좋겠다는 정도로 제안했다.
https://community.sonarsource.com/t/sonarqube-and-the-log4j-vulnerability/54721
- sonar.properties에 업데이트 
- 직접 환경변수로 업데이트 

둘다 결론은 같지만, 어차피 dev만 사용하는 툴이기때문에 `sonar.properties`에 업데이트를 하고 sonar를 껐다 키기로 했다. 

```bash:title=sonar.properties
sonar.search.javaAdditionalOpts=-Dlog4j2.formatMsgNoLookups=true
```
해당 줄을 sonarqube > config > `sonar.properties` 에 추가 후 

OS 에 맞는 sonar.sh 를 기동시켜준다. 
```bash 
Start:
$SONAR_HOME/bin/linux-x86-64/sonar.sh start

Graceful shutdown:
$SONAR_HOME/bin/linux-x86-64/sonar.sh stop

Hard stop:
$SONAR_HOME/bin/linux-x86-64/sonar.sh force-stop
```
https://docs.sonarqube.org/latest/setup/operate-server/

나는 centOS 작업이므로 linux-x86-64로.. 
```bash 
./sonar.sh stop 
./sonar.sh start
# start 
ps -ef | grep sonar 
# -Dlog4j2.formatMsgNoLookups=true 옵션이 JVM 에 넣어져서 실행한 것을 확인할 수 있음 
```


