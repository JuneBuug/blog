---
title   : 'ê¸€ììˆ˜ ì„¸ê¸°ì˜ ë”œë ˆë§ˆ, ì´ ê¸€ìì˜ ê¸¸ì´ëŠ” DB ìƒì—ì„œ ì–¼ë§ˆì¼ê¹Œ?' 
slug  : '/counting-character'
excerpt : 
date    : 2021-10-03 09:42:15 +0900
updated : 2021-10-17 15:32:57
tags    : 
- Grapheme
- Database
- Unicode
- Encoding
---

## ì„œë¡  
ê¸€ììˆ˜ë¥¼ ì„¼ë‹¤ëŠ” ê²ƒì€ ë¬´ì—‡ì¼ê¹Œ? ì´ ê¸€ì„ ë³¸ ê°œë°œìë¼ë©´ ì•„ë§ˆë„ ê°ì ì–¸ì–´ì˜ `length()` í•¨ìˆ˜ë¥¼ ë– ì˜¬ë ¸ì„ ìˆ˜ë„ ìˆê² ë‹¤. `length()` ëŠ” ê°œë°œìê°€ ê¸€ìë¥¼ ì„¸ì§€ì•Šì•„ë„ ë¹ ë¥´ê²Œ ê¸¸ì´ë¥¼ ì•Œë ¤ì¤€ë‹¤. 

ê·¸ëŸ°ë° ì´ `length()` ë¥¼ ë¯¿ì„ ìˆ˜ ìˆëŠ” ê±¸ê¹Œ? ğŸ¤¦â€â™€ï¸ ì–¼ë§ˆ ì „, ì´ëŸ° ì´ìŠˆì— ë¶€ë”ªí˜”ë‹¤. 

> `name` truncated too long ... 

ë¶„ëª…, 20ì ì œí•œì´ ìˆëŠ” ì„œë¹„ìŠ¤ì—ì„œ ê°€ì ¸ì˜¨ ì´ë¦„ì„ ê·¸ëŒ€ë¡œ ë„£ì—ˆëŠ”ë°, `varchar(255)` ê°€ ë¶€ì¡±í•´ì„œ ì•ˆë“¤ì–´ê°„ë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤. ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ì„œ ì–´ë–¤ ì´ë¦„ì—ì„œ ë°œìƒí–ˆëŠ”ì§€ ë³´ë‹ˆ, **ëˆˆìœ¼ë¡œëŠ”** ë¶„ëª… í•´ë‹¹ ì„œë¹„ìŠ¤ì—ì„œ ì œê³µí•˜ëŠ” 20ìê°€ ë§ë‹¤. 
ì™œ ì´ëŸ°ì¼ì´ ë°œìƒí–ˆì„ê¹Œ? 


## ê¸€ììˆ˜ ì„¸ê¸°ì˜ ë”œë ˆë§ˆ 
í•´ë‹¹ ë‹‰ë„¤ì„ì„ ë‹¨ìˆœí™”í•´ì„œ ì ‘ê·¼í•´ë³´ì. 
![ë‘ê°€ì§€ ë‹¨ì–´](./count-01.png) 
ìœ„ì˜ ë‘ ë‹¨ì–´, `June` ê·¸ë¦¬ê³  `ğŸ§ã€¶ãŠ„âœ˜` ëŠ” ìš°ë¦¬ ëˆˆì— 4ê¸€ìë¡œ ì¸ì‹ëœë‹¤. ê·¸ëŸ°ë° ë’¤ëŠ” ì¢€ ì˜ì‹¬ì´ ëœë‹¤. ì •ë§ ì´ê±° 4ê¸€ì ë§ì•„? ì»´í“¨í„°ë„ ê·¸ë ‡ê²Œ ìƒê°í• ê¹Œ? 

ìœ„ì—ì„œ ë°”ë¡œ 4ê¸€ìë¼ê³  ë‹µí–ˆë‹¤ë©´, ìš°ë¦¬ëŠ” ì´ë¥¼ `Grapheme clusters` ì˜ ê´€ì ì—ì„œ ë³´ê³  ìˆëŠ” ê²ƒì´ë‹¤. (ë°œìŒì€ ê·¸ë˜í”„ë¯¸ê°€ ì•„ë‹ˆë¼ ê·¸ë˜í•Œì´ì—ˆë‹¤..) Grapheme ì€ `ë¬¸ìì†Œ`ë¼ëŠ” ëœ»ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì¸ì§€í•˜ëŠ” í•˜ë‚˜ì˜ ê¸€ìë¥¼ ë§í•œë‹¤. 

ì´ëŸ° grapheme ê¸°ì¤€ì€ ì£¼ë¡œ ë‹¤ì–‘í•œ êµ­ê°€ì— ì„œë¹„ìŠ¤í•˜ëŠ” êµ­ê°€ì—ì„œ, ì•„ë˜ì²˜ëŸ¼ ì…ë ¥ëœ ê¸€ìì˜ ê¸€ììˆ˜ë¥¼ ì¹´ìš´íŠ¸í• ë•Œ ì‚¬ìš©í•œë‹¤. 
![line display name](./count-03.png)
ì°¸ê³ í•œ ë¼ì¸ ì—”ì§€ë‹ˆì–´ë§ ë¸”ë¡œê·¸ì— ë”°ë¥´ë©´, ë¼ì¸ì€ ë‹¤ì–‘í•œ êµ­ê°€ì— ì„œë¹„ìŠ¤í•˜ê³  ìˆìœ¼ë¯€ë¡œ ë‹¤ì–‘í•œ ì–¸ì–´ì™€ ê·¸ ê¸€ììˆ˜ê°€ ì‹¤ì œë¡œ ëª‡ byte ì°¨ì§€í•˜ëŠ”ì§€ ìƒê´€ì—†ì´, ì‚¬ëŒ ëˆˆì´ ì¸ì§€í•˜ëŠ” ë¬¸ìì†Œ ê°¯ìˆ˜ë¡œ ë°”ê¿”ì¤„ í•„ìš”ê°€ ìˆë‹¤. 

ë’¤ì§‘ì–´ì„œ ë§í•˜ë©´, 1 grapheme ê¸€ìëŠ” ê¸€ìì— ë”°ë¼ì„œ ì—¬ëŸ¬ ìœ ë‹ˆì½”ë“œ ë¬¸ìë¡œ ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤. 
ìœ ë‹ˆì½”ë“œ ìºë¦­í„° (U+0000~U+10FFFF ì‚¬ì´)ë¥¼ ìš°ë¦¬ëŠ” `code point ì½”ë“œ í¬ì¸íŠ¸`ë¼ê³  í•œë‹¤. 
ê°„ë‹¨í•˜ê²Œ ì¸ì§€í•˜ê³  ë„˜ì–´ê°€ê¸° ìœ„í•´ì„œ ìœ ë‹ˆì½”ë“œì˜ **ë²ˆí˜¸**ë¼ê³  ìƒê°í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.

## ì½”ë“œ í¬ì¸íŠ¸ì™€ UTF-8 / UTF-16ì˜ ê´€ê³„ 

í•˜ë‚˜ì˜ ì½”ë“œí¬ì¸íŠ¸ë¥¼ ë²ˆì—­(ì¸ì½”ë”©)í•˜ëŠ” ë°©ì‹ì€ ì—¬ëŸ¬ê°œê°€ ìˆëŠ”ë°, ê·¸ê²ƒì´ ìœ ëª…í•œ 
- UTF-8
- UTF-16 

ì´ë‹¤. 

í•˜ë‚˜ë¥¼ ë°”ë¼ë³´ëŠ” ë°©ì‹ì˜ ì°¨ì´ì¸ë°, UTF-8ì€ ê°€ì¥ ì‘ì€ ì½”ë“œ í¬ì¸íŠ¸ë¥¼ ë²ˆì—­í•  ë•Œ 1byteë¥¼ ì“°ê³ , ê°€ë³€ì ìœ¼ë¡œ ìµœëŒ€ 4byteê¹Œì§€ ì‚¬ìš©í•œë‹¤. 
UTF-16ì€ ê°€ì¥ ì‘ì€ ì½”ë“œ í¬ì¸íŠ¸ë¥¼ ë²ˆì—­í•´ë„ 2byteë¥¼ ì‚¬ìš©í•˜ê³ , ë²”ìœ„ì— ë”°ë¼ 4byte ë¥¼ ì‚¬ìš©í•˜ê¸°ë„ í•œë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´ë³´ì.
![u+007f](./count-08.png)
U+007Fë¼ëŠ” ì½”ë“œ í¬ì¸íŠ¸ë¥¼ ê°€ì§„ ë¬¸ìëŠ” â¡ ì´ë‹¤. 
ì´ ë¬¸ìë¥¼ ë²ˆì—­í• ë•Œ, UTF-8ì€ 1byte (7F, 8bit 2ì§„ë²•ìœ¼ë¡œëŠ” 0111 1111) ë¥¼ ì‚¬ìš©í•œë‹¤. 
ë°˜ë©´ UTF-16ì€ ê°™ì€ ì½”ë“œí¬ì¸íŠ¸ì— 2byteë¥¼ í• ë‹¹í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤. (00 7F, 0000 0000 0111 1111)


ë˜ ë‹¤ë¥¸ ì˜ˆë¥¼ ë³´ì. 
![u+10000](./count-09.png)
ì¢€ ë†’ì€ ì½”ë“œí¬ì¸íŠ¸ì˜ ë²”ìœ„ì¸ U+10000 ì˜ ë¬¸ìëŠ” 

UTF-8 ê¸°ì¤€ìœ¼ë¡œ `F0 90 80 80` ìœ¼ë¡œ, 4byteë¥¼ ì‚¬ìš©í–ˆë‹¤. 
UTF-16 (Big endian) ê¸°ì¤€ìœ¼ë¡œëŠ” `D8 00 DC 00` ìœ¼ë¡œ í‘œê¸°í•˜ê³ , 4byteë¥¼ ì‚¬ìš©í–ˆë‹¤. 

(ê°’ì´ ë‹¤ë¥¸ ê²ƒì— ì˜ì•„í•  ìˆ˜ ìˆì§€ë§Œ, UTF-8, UTF-16ì€ ì´ ë²”ìœ„ì— ëŒ€í•´ì„œëŠ” íŠ¹ì • bitë¥¼ ê³ ì •í•´ë†“ê³  ì‚¬ìš©í•œë‹¤! ëŠ” ì •ì±…ì´ ë‹¬ë¼ì„œ ê·¸ë ‡ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì—¬ê¸°](https://ko.wikipedia.org/wiki/UTF-1)ë¥¼ ì°¸ì¡°.)

ì´ë ‡ê²Œ ì½”ë“œí¬ì¸íŠ¸ë¥¼ í‘œí˜„í•˜ëŠ”ë° ìµœì†Œí•œ í•„ìš”í•œ byte ê°¯ìˆ˜ë¥¼ `code unit ì½”ë“œ ìœ ë‹›` ì´ë¼ê³  í•œë‹¤. 
UTF-8ì˜ ì½”ë“œ ìœ ë‹›ì€ 1byteì´ê³ , UTF-16ì˜ ì½”ë“œ ìœ ë‹›ì€ 2 byteì´ë‹¤. 

## ì˜ˆì œ: ğŸ¤¦â€â™€ï¸ ë¡œ ë³´ëŠ” íŠ¹ì •í•œ ê¸€ìê°€ -> JAVA ì½”ë“œ -> MYSQL DB ê¹Œì§€ í˜ëŸ¬ê°€ëŠ” ê³¼ì •
![ì´ëª¨ì§€ë¡œ ë³´ëŠ” íŠ¹ì • ê¸€ìê°€ DBê¹Œì§€ í˜ëŸ¬ë“¤ì–´ê°€ëŠ” ê³¼ì •](./count-10.png)

ë‹¤ì‹œ ëŒì•„ê°€ì„œ 
> 1 grapheme ê¸€ìëŠ” ê¸€ìì— ë”°ë¼ì„œ ì—¬ëŸ¬ ìœ ë‹ˆì½”ë“œ ë¬¸ì(ì½”ë“œí¬ì¸íŠ¸) ì´ë£¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤ 

ì˜ ì˜ë¯¸ë¥¼ ì‚´í´ë³´ì. 

ìš°ë¦¬ê°€ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì´ëª¨ì§€ ì¤‘, ğŸ¤¦â€â™€ï¸ ëŠ” ë‹¨ë… ì½”ë“œí¬ì¸íŠ¸ë¡œ êµ¬ì„±ëœ ê²ƒì´ ì•„ë‹ˆë‹¤. 
- ê³¨ì¹˜ì•„íŒŒí•˜ëŠ” ì‚¬ëŒ 1F926 ğŸ¤¦
- ì—°ê²°ì   200D
- ì—¬ì„± ê¸°í˜¸ 2640 â™€ï¸
- ë³€í˜•ì„ íƒê¸° FEOF

ì´ë ‡ê²Œ 4ê°€ì§€ ì½”ë“œ í¬ì¸íŠ¸ì˜ êµ¬ì„±ì„ì„ ìœ„ ì´ë¯¸ì§€ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

ì°¸ê³ ë¡œ ì´ ì½”ë“œí¬ì¸íŠ¸ë¥¼ í•˜ë‚˜í•˜ë‚˜ UTF-16 BEë¡œ ë²ˆì—­í•˜ë©´ 
`0xD83E 0xDD26 0x200D 0x2640 0xFE0F`ì´ë‹¤. ì¦‰ 10byte ê¸¸ì´ë¡œ ì¸ì½”ë”©ì´ ëœë‹¤.

Java ì½”ë“œì—ì„œëŠ” ì´ê²Œ ì–´ë–»ê²Œ í‘œí˜„ë ê¹Œ? 

```java
String result = "ğŸ¤¦â€â™€ï¸"; // ê¸€ì
System.out.println(result);
System.out.println(result.length()); // ê°’: 5
System.out.println(result.codePointCount(0,5)); // length ê¹Œì§€ì˜ code point ê°¯ìˆ˜ : 4 
byte[] utf8bytes = result.getBytes(StandardCharsets.UTF_8); // ê°’: 13
byte[] utf16bytes = result.getBytes(StandardCharsets.UTF_16BE); // ê°’ 10

System.out.println("--- UTF-8 ë²„ì „ code point --- ");
for (int i=0; i<utf8bytes.length; i++) {
    int hex = utf8bytes[i] & 0xff;
    System.out.print(String.format("0x%04X", hex));
    System.out.print(" ");
}

System.out.println("--- byte ê¸¸ì´ --- ");
System.out.println(utf8bytes.length);

System.out.println("--- UTF-16 ë²„ì „ code point --- ");
for (int i=0; i<utf16bytes.length; i++) {
    int hex = utf16bytes[i] & 0xff;
    System.out.print(String.format("0x%04X", hex));
    System.out.print(" ");
}
System.out.println("--- byte ê¸¸ì´ --- ");
System.out.println(utf16bytes.length);
```

javaì—ì„œ ê°€ì¥ ë¨¼ì € í•´ë³¼ ê²ƒì€ ì´ Stringì˜ lengthë¥¼ ì¬ëŠ” ì¼ì´ë‹¤. `String.length()`ëŠ” ì´ 1 grapheme ë¬¸ìì˜ ê¸¸ì´ë¥¼ 5ë¼ê³  í–ˆë‹¤. 

![String-length](./count-12.png)
String length í•¨ìˆ˜ì˜ ì„¤ëª…ì—ëŠ” ì´ë ‡ê²Œ ì í˜€ìˆë‹¤.

> í•´ë‹¹ ë¬¸ìì—´ì˜ ìœ ë‹ˆì½”ë“œ **ì½”ë“œ ìœ ë‹›**ì˜ ê°¯ìˆ˜ì™€ ê°™ë‹¤.

ìœ„ì—ì„œ ì½”ë“œ ìœ ë‹›ì„ ì ê¹ ì–¸ê¸‰í–ˆì§€ë§Œ, UTF-8 ì—ì„œëŠ” ì½”ë“œ ìœ ë‹›ì´ 1byte, UTF-16ì—ì„œëŠ” ì½”ë“œ ìœ ë‹›ì´ 2byteì´ë‹¤. 

- ìë°”ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ UTF-16ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°,ìœ„ì—ì„œ ì–¸ê¸‰í•œëŒ€ë¡œ 
ğŸ¤¦â€â™€ï¸ = `0xD83E 0xDD26 0x200D 0x2640 0xFE0F` (in UTF-16) ì´ë‹¤.

- ìš°ë¦¬ê°€ ì›í•˜ëŠ” ë‹µì€ `ê·¸ëŸ¬ë©´ 2byte ì”© ëª‡ê°œ ë¬¶ì—¬ìˆì–´?` ì™€ ê°™ì€ ì§ˆë¬¸ì´ ë˜ê³ ,
2byteì”© ë¬¶ì€ ê²°ê³¼ëŠ” ë³´ì´ëŠ” ëŒ€ë¡œ 5ë¬¶ìŒì´ë‹¤.

- ê·¸ ê²°ê³¼ `String.length()`ëŠ” ìš°ë¦¬ì—ê²Œ 5ë¼ëŠ” ê²°ê³¼ê°’ì„ ë³´ì—¬ì¤€ë‹¤. 

ë‹¤ìŒì€ **code pointì˜ ê°¯ìˆ˜** ë¥¼ ì²´í¬í•´ë³´ê³  ì‹¶ë‹¤. ì´ ë¬¸ìëŠ” ì•ì„œ ë§í–ˆë“¯ì´ 4ê°œì˜ ì½”ë“œ í¬ì¸íŠ¸ë¡œ ì´ë£¨ì–´ì¡Œë‹¤. ì´ ê°¯ìˆ˜ë¥¼ ìë°” ì½”ë“œìƒì—ì„œ ë³´ê¸° ìœ„í•´ì„œëŠ” `codePointCount(0, length)` ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì´ ë¶€ë¶„ë„ ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” 4ë¼ëŠ” ê²°ê³¼ê°’ì„ í‘œì‹œí–ˆë‹¤. 

ê·¸ëŸ¼ ì´ì œ ì´ java Stringì´ mysql DB ë¡œ ë“¤ì–´ê°ˆë• ì–´ë–¨ê¹Œ? 
ë‹¤ìŒ sqlë¡œ Stringì˜ ê¸¸ì´ë¥¼ ë¯¸ë¦¬ í™•ì¸í•  ìˆ˜ ìˆë‹¤. 

```sql 
SELECT LENGTH("ğŸ¤¦â€â™€ï¸";) # 13
```


ì´ ê°’ë„ ì•ì„  ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ë°”ë¡œ Stringì„ UTF-8ë¡œ ë°”ê¿¨ì„ ë•Œ bytesì˜ ê¸¸ì´, 13ì´ë‹¤.
ê·¸ëŸ¼ ì™œ ì´ëŸ° ê²°ê³¼ê°€ ë‚˜ì™”ì„ê¹Œ? 

> Values in VARCHAR columns are variable-length strings. The length can be specified as a value from 0 to 65,535. The effective maximum length of a VARCHAR is subject to the maximum row size (65,535 bytes, which is shared among all columns) and the character set used. See Section 8.4.7, â€œLimits on Table Column Count and Row Sizeâ€. -dev.mysql.com 

varchar ì¹¼ëŸ¼ì˜ ê¸¸ì´ëŠ” ìµœëŒ€ row size(65,535) byteì™€ character setì— ì¢…ì†ì ì´ë‹¤.

í˜„ì¬ DBì˜ character set ì„¤ì •ì„ í™•ì¸í•´ë³´ë©´ 
```sql 
SELECT * FROM information_schema.SCHEMATA; #utf8mb4
```
utf8mb4ë‹¤. ì¦‰ utf8 ê¸°ì¤€ìœ¼ë¡œ db character set ì´ ì„¤ì •ë˜ì–´ìˆë‹¤. 

ìš”ì•½í•˜ë©´ ğŸ¤¦â€â™€ï¸ ëŠ” 

- java ì½”ë“œ ìƒì—ì„œëŠ” length 5
- utf8 character set mysql ê¸°ì¤€ varchar(13) ì•ˆì— ë“¤ì–´ê°

ì´ë¼ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. 

ì´ë•Œë¬¸ì— ë‹¨ìˆœíˆ length í•¨ìˆ˜ë¥¼ ê¸¸ì´ ì²´í¬ì— ì‚¬ìš©í•œë‹¤ë©´,
DBì—ì„œëŠ” truncated ë  í™•ë¥ ì´ ë°œìƒí•œë‹¤. 

### ë§ˆì¹˜ë©°: 1 grapheme ë‹¹ ì ì •í•œ varchar ê¸¸ì´ 

1 grapheme ë‹¹ ì ì •í•œ varcharì˜ ê¸¸ì´ëŠ” [ë¼ì¸ ì—”ì§€ë‹ˆì–´ë§ ë¸”ë¡œê·¸](https://engineering.linecorp.com/ko/blog/the-7-ways-of-counting-characters/) ì—ì„œëŠ” 1:12 ì •ë„ê°€ ì ë‹¹í•˜ë‹¤ê³  ì œì•ˆí•˜ê³  ìˆë‹¤. ë‹¤ë§Œ, ì´ ê°’ì€ ì ˆëŒ€ì ì¸ ê²ƒì´ ì•„ë‹ˆë©°, ì„œë¹„ìŠ¤í•˜ëŠ” êµ­ê°€ì˜ ì–¸ì–´í™˜ê²½ê³¼ ì»¨í…ìŠ¤íŠ¸ ê³ ë ¤ê°€ í•„ìš”í•˜ë‹¤ê³  í•œë‹¤. 

ì‹¤ì œë¡œ ë§ˆì£¼ì¹œ ì˜¤ë¥˜ëŠ” varchar(255) ì— grapheme 20 ìë¥¼ ë„£ìœ¼ë ¤ê³  í–ˆìœ¼ë‚˜, DB ìƒì—ì„œ ê¸¸ì´ 277ì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆë‹¤. ê·¸ëŸ¬ë‹ˆ 12 ì´ìƒì˜ ë°°ìœ¨ì´ í•„ìš”í–ˆë˜ ê²ƒì´ë‹¤. ğŸ¤”
ì´ëŸ° ë¶€ë¶„ì„ ê¼­ ìœ ì˜í•´ì„œ ì‚¬ìš©í•˜ë„ë¡ í•˜ì! 


## ì°¸ê³  

- https://engineering.linecorp.com/ko/blog/the-7-ways-of-counting-characters/

- https://ko.wikipedia.org/wiki/UTF-1

- https://www.emojiall.com/ko/code/1F926-200D-2640-FE0F

- https://dev.mysql.com/doc/refman/8.0/en/char.html
