---
slug: "/2019-02-12/resttemplate-vs-webclient"
updated: 2021-10-03 09:41
title: RestTemplate ë§ê³  WebClient
date: 2019-02-11
tags: 
    - Spring 
    - Java
---
ê°€ì¥ ë¨¼ì € ì½”ë“œë¡œ ë³¸ web ìš”ì²­ ì¸í„°í˜ì´ìŠ¤ëŠ” WebClientì˜€ê³ , ëª…í™•í•˜ê³  ì§ê´€ì ì´ì—¬ì„œ ìì£¼ ì¼ë‹¤.

ê·¸ëŸ°ë° í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” RestTemplateê³¼ WebClientê°€ í˜¼ì¬ë˜ì–´ìˆì–´ì„œ, ì´ ë‘˜ì— ëŒ€í•´ì„œ ì¡°ê¸ˆ ì•Œì•„ë³¼ê¹Œ í•œë‹¤. 

## ë­ê°€ ë” ë¨¼ì € ë‚˜ì™”ì„ê¹Œ : RestTemplate

WebClient vs RestTemplateìœ¼ë¡œ ì¹˜ë©´ ìŠ¤íƒì˜¤ë²„í”Œë¡œìš° ê¸€ í•˜ë‚˜ê°€ ë‚˜ì˜¨ë‹¤. 

"ì•¼ Spring 5ë¡œ ì—…ê¸€í•˜ê³  ì‹¶ìœ¼ë©´ RestTemplate ëª»ì”€??? ê·¸ëŸ¼ RestTemplateì“´ ì˜›ë‚  ì–´í”Œë¦¬ì¼€ì´ì…˜ë“¤ ì–´ë–¡í•¨?? ë‹¤ WebClient ì¨ì•¼í•´? " [https://stackoverflow.com/questions/47974757/webclient-vs-resttemplate](https://stackoverflow.com/questions/47974757/webclient-vs-resttemplate)

ì¹¨ì°©í•˜ê²Œ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì´ë ‡ê²Œ ë‹µë³€í•´ì¤¬ë‹¤.

"ì•„ë‹ˆ RestTemplate ê³„ì† ìˆì„ê±°ê³  WebClient ì•ˆì¨ë„ ë¼. ì œì¼ í° ì°¨ì´ëŠ” RestTemplateì€ **synchronousí•˜ê³  blocking** í•˜ë‹¤ëŠ” ê±°ì„. ê·¸ê²Œ ë¬´ìŠ¨ ë§ì´ëƒë©´... web ìš”ì²­ì„ í•˜ê³  ë‹¤ìŒ í–‰ë™ì„ í•˜ë ¤ë©´ responseê°€ ì˜¬ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼í•œë‹¤ëŠ” ëœ»ì„ã…ã… WebClientëŠ” ì™„ì „ ë°˜ëŒ€ì•¼. í˜¸ì¶œí•œ ì‚¬ëŒì€ response ì˜¬ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ê³ , responseê°€ ì˜¤ë©´ ì•Œë¦¼ì„ ë°›ê²Œ ë ê±°ì„!!! 

ê·¸ëŸ° ê¸°ëŠ¥ í•„ìš”í•˜ë©´ WebClientë¡œ ê°ˆì•„íƒ€ì‹œê³ ~ WebClientì—ì„œ resttemplateì²˜ëŸ¼ **synchronous**í•˜ê²Œë„ ì“¸ ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ (block()) ì˜ìƒê°í•´ë´~ ì°¸ê³ ë¡œ ë°˜ëŒ€ ë°©í–¥(Rest templateì—ì„œ Webclient ì²˜ëŸ¼ ì“°ê¸°) ëŠ” ì•ˆë¨ =) " 

"Java Docì´ ê·¸ëŸ¬ëŠ”ë° RestTemplate ë‚˜ì¤‘ì—~~~~~ deprecatedë ê±°ë˜ [https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html) " 

ì •ë¦¬í•´ë³´ë©´, 

- RestTemplateì€ WebClient ë³´ë‹¤ ì´ì „ì— ë‚˜ì™”ë‹¤
- RestTemplateì€ ë™ê¸°ì‹ì´ë©°, responseê°€ ì˜¬ ë•Œê¹Œì§€ ë‹¤ìŒ í–‰ë™ìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ë‹¤
- RestTemplateì€ ê³§ deprecated ë˜ì–´ ì—­ì‚¬ì˜ ë’¤ì•ˆê¸¸ë¡œ ì‚¬ë¼ì§€ê²Œ ë ê±°ë‹¤ (ã… ã… )

## ê·¸ëŸ¼ WebClient ë¶€í„° ì•Œì•„ë³´ì

[https://www.baeldung.com/spring-5-webclient](https://www.baeldung.com/spring-5-webclient)

WebClientëŠ” ì›¹ ìš”ì²­ì„ í•˜ëŠ” ë° ìˆì–´ ì¶œì…ë¬¸ ì—­í• ì„ í•˜ëŠ”!  ì¸í„°í˜ì´ìŠ¤ì´ë‹¤. 

`Spring Web Reactive` ëª¨ë“ˆì— í¬í•¨ë˜ì–´ ìˆê³ ,  RestTemplate ì„ ëŒ€ì²´í•œë‹¤.

## ì„¤ì¹˜/ì˜ì¡´ì„± ì„¤ì •

gradleì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ dependencies ë¥¼ ì„¤ì •í•´ì¤€ë‹¤.
```groovy
    dependencies {
        compile 'org.springframework.boot:spring-boot-starter-webflux'
        compile 'org.projectreactor:reactor-spring:1.0.1.RELEASE'
    }
```
## WebClient Instance ìƒì„±í•˜ê¸°

í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œì—ì„œëŠ” builder íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
```java
    Webclient client = WebClient
                    .builder()
                    .baseUrl("http://localhost:8080")
                    .defaultCookie("ì¿ í‚¤í‚¤","ì¿ í‚¤ê°’")
                    .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                    .build();
```
## Request ìš”ì²­í•˜ê¸°

1. ì¼ë‹¨ HTTP ë©”ì†Œë“œë¥¼ ì •í•´ì•¼í•œë‹¤. 
```java
WebClient.UriSpec<WebClient.RequestBodySpec> req = client.post();
```
2. ë‘ë²ˆì§¸ë¡œ uri APIë¥¼ ì œê³µí•´ì•¼í•œë‹¤. String í¬ë§· í˜¹ì€ `java.net.URL` í¬ë§·ìœ¼ë¡œ ë„˜ê¸´ë‹¤.
```java
WebClient.RequestBodySpec uri = client
                                .post()
                                .uri("/search");
```
3. í•„ìš”í•˜ë‹¤ë©´ Requestì— `body, content-type,length, cookie, header` ë“±ì„ í¬í•¨í•  ìˆ˜ ìˆë‹¤. 
```java
WebClient.RequestHeadersSpec<?> req2 = client.post().
                                                .uri("/search")
                                                .body(BodyInserters.fromObejct("data"));
```

ì•„ì˜ˆ ë‹¤ë¥´ê²Œ ì ‘ê·¼í•  ìˆ˜ë„ ìˆë‹¤. ì›í•˜ëŠ” urië¥¼ ì§ì ‘ ë§Œë“¤ì–´ ìš”ì²­í•˜ëŠ” ë°©ì‹ì´ë‹¤. 
```java
private final WebClient.RequestHeaderUriSpec<?> baseSpec;

baseSpec = Webclient.builder().baseUrl("ì£¼ì†Œ").build().get();

// baseSpecì— ì›í•˜ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ê°€ë¡œ ë¶™ì—¬ì„œ ìš”ì²­í•œë‹¤. 
baseSpec.uri(builder -> builder.path("/")
                                                                .queryParam("ì´ë¦„","ê°’")
                                                                .builder()
                            )
                        .retrieve() // Responseë¥¼ ë°›ì•„ì˜´.
```
## Responseë¥¼ ë°›ì•„ì˜¤ê¸°

ì´ ê³¼ì •ì—ëŠ” ë‘ ë°©ë²•ì´ ìˆë‹¤.

`exchange`ëŠ” `ClientResponse`ë¥¼ ìƒíƒœê°’ ê·¸ë¦¬ê³  í—¤ë”ì™€ í•¨ê»˜ ê°€ì ¸ì˜¤ëŠ” ë°˜ë©´ì—,

`retrieve` ëŠ” bodyë¥¼ ë°”ë¡œ ê°€ì ¸ì˜¨ë‹¤.
```java
String response = req.exchange().block().bodyToMono(String.class).block();

String response2 = req2.retrieve().bodyToMono(String.class).block();
```
ì—¬ê¸°ì„œ `bodyToMono` ëŠ” ê°€ì ¸ì˜¨ bodyë¥¼ Reactorì˜ `Mono` ê°ì²´ë¡œ ë°”ê¿”ì¤€ë‹¤. `Mono` ê°ì²´ëŠ” 0-1ê°œì˜ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°ì²´ì´ê³ , ë°˜ë©´ `Flux` ëŠ” 0-Nê°œì¸ ê²°ê³¼ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°ì²´!

ìœ„ì—ì„œ `block` ì„ ì‚¬ìš©í•˜ë©´ Rest Templateì²˜ëŸ¼ ë™ê¸°ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê³  í–ˆë‹¤. 

blockì„ Monoì— ì‚¬ìš©í•˜ì—¬, responseì™€ í•¨ê»˜ ì „ì†¡ëœ ì‹¤ì œ ë°ì´í„°ë¥¼ êµ¬ë…í•˜ê³  ì–»ì–´ ì˜¬ ìˆ˜ ìˆë‹¤! 

## RestTemplateë„ ì–´ë–»ê²Œ ì“°ëŠ” ê±´ì§€ ì•Œì•„ëŠ” ë³´ì

ì°¸ê³ :

[https://sjh836.tistory.com/141](https://sjh836.tistory.com/141)


RestTemplateë„ ìƒì„±ê³¼ ì‚¬ìš©ì´ ê·¸ë ‡ê²Œ ì–´ë µì§€ ì•Šë‹¤. 

### ì‹œì‘í•´ë³´ì 

ì¼ë‹¨ ì¹¨ì°©í•˜ê²Œ RestTemplate ì„¤ì •ì„ ìœ„í•œ Config í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤. 
```java
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.retry.annotation.EnableRetry;
import org.springframework.web.client.RestTemplate;

@Configuration
@EnableRetry
public class RestTemplateClient {

    @Bean
    public RestTemplate restTemplate(RestTemplateBuilder builder) {
        return builder.build();
    }
}
```
Configí´ë˜ìŠ¤ëŠ” `@Configuration` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆì–´ì•¼í•œë‹¤. ì´ë ‡ê²Œ í•´ì£¼ëŠ” ì´ìœ ëŠ” ìš°ë¦¬ í”„ë¡œì íŠ¸ì—ì„œ ê¸°ì¡´ ë°©ë²•ìœ¼ë¡œ RestTemplate ì„ ë¹ˆìœ¼ë¡œ ì¸ì‹í•˜ì§€ ì•Šì•˜ê¸°ë•Œë¬¸ì´ë‹¤. builderë¥¼ ê±°ì³ì„œ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤.

ì´ì œ ìš”ì²­ì„ ì›í•˜ëŠ” í´ë˜ìŠ¤ì— ê°€ì„œ restTemplate í•„ë“œë¥¼ `@Autowired` ë¥¼ ì‚¬ìš©í•´ì„œ ì£¼ì…í•´ì¤€ë‹¤. 

 ResttemplateBulilder.build()ë¥¼ ì‚¬ìš©í•´ì„œ ë§Œë“¤ì–´ì„œ ì£¼ì…í•´ì£¼ëŠ” ê²½ìš°ë„ ìˆë‹¤. 

### ì‚¬ìš©í•˜ê¸° 

ì£¼ìš” ë©”ì†Œë“œë¥¼ `restTemplate.ë©”ì†Œë“œëª…` ê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´ ëœë‹¤. 

- execute(): Request / Response ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆë‹¤. HTTP methodë¥¼ ì§ì ‘ ì§€ì • ê°€ëŠ¥
- exchange() : Http headerë¥¼ ìˆ˜ì •ê°€ëŠ¥í•¨. ì‘ë‹µì€ HttpResponseEntity í˜•íƒœ
- getForObject(String url, ì›í•˜ëŠ” í´ë˜ìŠ¤íƒ€ì…): Http headerëŠ” ê¸°ë³¸ í˜•íƒœ. ì‘ë‹µì€ ì›í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ í˜•íƒœë¡œ ê²°ê³¼ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.
- getForEntity(): Http headerê°€ ê¸°ë³¸ í˜•íƒœ. ì‘ë‹µì€ HttpResponseEntity í˜•íƒœ.
- postForObject: post ìš”ì²­ì„ ë³´ëƒ„, ì‘ë‹µì€ HttpResponseEntity í˜•íƒœ
```java
public class TestClass {
    @Autowired 
    RestTemplate restTemplate;

    public TestClass(RestTemplate restTemplate){
            this.restTemplate = restTemplate;
    }

    public String getSthFromServer(){
        return restTemplate.getForObject("http://api.com/search?text=í˜¸ì´",String.class);
    }
}
```

## ê²°ë¡ 

ê²°ë¡ ì ìœ¼ë¡œëŠ”, Spring í”„ë¡œì íŠ¸ê°€ RestTemplateì—ì„œ WebClientë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ê³  ìˆëŠ” ì¶”ì„¸ì´ê³  ì¶”í›„ ì§€ì›ì„ ì¤‘ë‹¨í• ì§€ë„ ëª¨ë¥´ë‹ˆ WebClientë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤. ğŸ¤” 

WebClientê°€ ê¸°ë³¸ ë¹„ë™ê¸°ì‹ì´ê¸´ í•˜ì§€ë§Œ, ë™ê¸°ì‹ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤ëŠ” ì¥ì  ë˜í•œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ì´ìœ ê°€ ë  ìˆ˜ ìˆê² ë‹¤.



