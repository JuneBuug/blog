---
layout: wiki
title: '리눅스 시스템 관리 cheatsheet'
updated: 2020-04-08 12:06:30 +0900
date: 2020-02-27
slug: "/linux-cheatsheet"
tags: 
   - Linux
   - CLI
   - Network
banner: ./thumb.png
---

## Shell 이란 
  사용자와 OS간의 징검다리 

### Shell script
  - 빠르고 간단한 프로토타입으로서의 역할 
  - 반복되는 일련의 커맨드나 유틸리티 실행 작업을 한번에 묶어서 처리한다
  - 스크립트 첫줄의 # 는 스크립트를 해석할 프로그램을 지정 

### shell 종류 
  - bash : 리눅스 기본 shell. 전통 shell인 sh와 호환
  - csh : c 와 비슷한 문법의 shell 
  - ksh : sh와 호환 O, csh 문법도 지원 
  - tcsh : csh의 확장판. 커맨드라인 입력기능 보강

## 기본문법 

### 리다이렉션 
- 입력은 키보드 , 출력은 터미널
- STDIN (키보드, 0) , STDOUT(터미널, 1), STDERR(터미널, 2)
이것을 제어하고 싶을 때 입력.

- `>` 파일을 생성하여 출력을 저장 
- `>>` 파일이 존재한다면, 끝에 추가하라
- `<` 파일의 내용을 불러온다 
- `2>` STDERR를 리다이렉션한다 
- `>&` STDERR, STDOUT 모두 리다이렉션한다 
- `2>&1` STDERR를 STDOUT으로 리다이렉션한다 

" 리눅스 cron 에서 리다이렉트안하면 계정의 메일함으로 결과가 가서 파티션 용량이 떨어진다.. 👀 파일이나 /dev/null 로 떨어뜨리는 것이 중요!

### 파이프 
프로그램이나 명령어의 **출력**을 다른 명령어나 프로그램의 **입력** 으로 연결해주는 기능 `|`

```bash
ps aux | grep ssh
```
프로세스의 정보를 출력한 다음 ssh 만 뽑기 

```bash 
ls | xargs cat 
```
파일 목록을 뽑은 다음 이 내용을 전부 cat 하기 (xargs는 인자가 많을때 사용) 

### 변수 
- 대소문자 구분, `=`으로 값을 지정 
- 변수를 미리 선언하지 않아도, 최초 사용시 자동 할당 

#### 자주 사용되는 환경변수 
- GROUPS : 유저의 그룹목록
- PWD : 현재 디렉토리 
- PATH: PATH정보 
- RANDOM : 0~32767 까지의 랜덤값 

#### 특수변수 
- `$@` / `$*` 인자의 모든 값
  - 하지만 
    ```bash 
    "$*" # 여러개의 인자들이 하나의 문자열 
    "$@" # 각 인자 하나하나를 따옴표로 감쌈
    # 인자에 공백을 넣고싶은 경우 이렇게 
    ```
- `$#` 파라미터의 전체 개수 
- `$?` foreground 종료의 상태값 
- `$$` 현재 쉘 프로세스 ID
- `$0` 쉘 스크립트의 이름 

#### 인자 
쉘스크립트에 넘긴 순서대로 `$0(파일명)` ~ `$1`,`$2`,,, 의 형식



## ssh : 다른 컴퓨터를 리모트로 조작하자

secure shell

### 접속하기
```bash
ssh <로그인사용자명>@<접속할pc주소> 
# 이때 주소는 ip주소또는 hostname이다 
```
### 왜 안전한 shell 인가?

rsh도 있다 (remote shell) 하지만 이 경우 암호를 입력하면 그대로 네트워크로 보내버린다. 이런 경우 네트워크를 감시하고 있으면 (wireshark 등으로! 🦈) 그대로 암호를 알 수 있을뿐 아니라 파일 내용도 볼 수 있다. 

## X Server: 리모트로 데스크탑 화면을 띄우자

리눅스에서 화면 표시와 입력을 담당하는 구조. ssh를 사용하면 다른 PC와는 통신만 하고, 본인 PC에서 x를 띄워 사용할 수 있음 . 데스크탑 환경이 항상 설치되어있는 것은 아니므로 CLI에  익숙해질 것

## sudo: 관리자 권한을 잠시 취득하자

root 는 관리자 권한을 가진 특별한 사용자! 파일 접근 권한을 변경하거나 다른 사람의 파일을 수정하거나 등 뭐든 지 가능한 관리자 👑우분투는 이를 막기위해 일반 상황에서는 root로 로그인이 불가능하게 막고 있다. 

> 권장하진 않지만, sudo -i 혹은 sudo su로 로그인이 가능할 수 있다.

root말고도 일반 관리자 권한을 줄 수 있다. 일반 관리자는 필요할 때만 암호를 입력하고 그때만 위의 특권을 사용할 수 있음 ! 암호를 입력하기 위해서는 sudo를 사용해야한다 ! 

## grep: 다양한 문자열을 검색하자

보통 `ps -ef | grep <문자열>` 등으로 프로세스 검색할 때 많이 쓰고 있는 grep 이다. 파일 내용을 확인해서 찾는 내용이 포함되었는지 알려주는 명령어. 
```bash
grep -r "검색하고싶은 문자열 혹은 정규표현식" <경로>
# -r 은 서브 폴더까지 검색하도록 지정이라는 뜻
```
## vi / vim : CLI에서 문서를 편집하자

- 검색 `/`
- 복사 (yank) & 붙여넣기 (paste)
```bash
# 커서를 원하는 곳으로 옮긴다 
# 노멀모드 상태에서 v를 눌러 비주얼모드로 진입
# 화살표로 커서를 움직여 선택 
# y를 눌러 복사
# 원하는 곳에서 `shift` + `p` 를 눌러 paste
# 횟수를 입력하고 `shift` + `p` 를 누르면 원하는 만큼 복사된다.
# e.g) 10 `shift` + `p` 
```

- 되돌리기
    - `ctrl + z` 는 실행중인 애플리케이션을 일시정지하는 조작! `fg` 로 다시 실행가능하다.
    - `U`  undo, `ctrl + R` 은 redo

## 가상터미널 tmux: 네트워크 끊김에서 복귀하자

ssh 해서 바로 터미널에 붙어서 사용하다가, 네트워크가 끊기면 원격 서버에서는 사용자가 로그아웃한 것으로 간주해 작업을 종료해버린다. 

하지만, tmux를 원격 서버에서 실행하면 새로운 중계포인트가 된다. 그래서 네트워크가 끊겨도 tmux 뒤쪽의 어플리케이션에서는 유저가 로그인한 것 처럼 보이고 재접속 후 `tmux attach` 를 사용하면 가상터미널에 다시 붙을 수 있다. 가상 터미널에서는 실행한 애플리케이션이 계속 돌고 있으니까 =) 큰 배치처리를 실행하고 원래 개인 pc를 종료하고 퇴근해도 되고!

원격서버를 사용하는 경우면 tmux를 사용해야할 이유가 더 커진다. 내 컴퓨터에서 터미널을 열어서 매번 ssh 접속을 해서 같은 서버로 들어가서 다른 명령을 실행하려면 ... 😭 tmux를 사용하여 tmux 새 세션을 연다고 하면, ssh 접속도 한번, 인증도 한번! 

tmux의 프리픽스키는 `ctrl` + `b` 이다. 

- 종료 : prefix  + D (Detach)
- 새 세션 생성 : prefix  + C(Create)
- 이전 세션: prefix + P (Previous)
- 다음 세션 : prefix + N (Next)
- 화면 분할 (가로로 분할) : prefix + "
- 화면 분할 (세로 분할) : prefix + %
- 분할 화면 포커스 설정 : prefix + 화살표키
- 화면에서 스크롤 : prefix : [

## 명령어 히스토리 : 이전에 썼던 명령어를 검색하자

`ctrl + r` 를 반복해서 누르면 이전 명령어를 계속 찾는다! (후방검색)

`ctrl + s` 를 반복해서 누르면 이후 명령어를 찾는다! (전방검색)  but 이 매핑을 전방검색으로 사용하기 위해서는 bashrc나 zshrc에서  `stty stop undef` 를 하고 source해서 적용시켜줘야함 

but 가상터미널은 기본적으로 명령어 history를 공유하지 않으므로 주의하자. 공유하도록하려면 
```bash
   function share_history {
      history -a
      history -c 
      history -r
   }
   
   PROMPT_COMMAND='share_history'
   shopt -u histappend
```


출처: 만화로 배우는 리눅스 시스템 관리 1  by piro 
만화 자체가 원하는 목적 → 거기에 맞는 명령어나 함수로 이루어져있어서 접근하기 쉽다.
추가로 정리할 때마다 업데이트 예정!
