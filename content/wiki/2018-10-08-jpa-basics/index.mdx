---
slug: "/2018-10-08/jpa-basics"
updated: 2020-03-09 14:21
title: JPA ê°€ ë­”ë° ì“°ëŠ”ê±´ê°€ìš”?
date: 2018-10-08
tags: 
    - JPA
    - Java
---

Springì„ ê³µë¶€í•˜ë˜ ì¤‘ì—, ë©˜í† ë‹˜ê»˜ì„œ JPAì˜ ì¤‘ìš”ì„±ì„ ê°•ì¡°í•´ì£¼ì…¨ìŠµë‹ˆë‹¤. 
Django ëŠ” ORM ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ DBë¥¼ ë‹¤ë£¨ê³  ì“¸ ìˆ˜ ìˆì—ˆëŠ”ë°, Springì—ì„œëŠ” ì–´ë–¤ ì‹ìœ¼ë¡œ DBì— ì ‘ê·¼í•˜ê³  ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì§€ ê¶ê¸ˆí•´ì¡ŒìŠµë‹ˆë‹¤.

ì„¤ë§ˆ í•™êµì—ì„œ í•˜ë˜ ê²ƒ ì²˜ëŸ¼ í˜„ì—…ì—ì„œ ì§ì ‘ DBì— ì»¤ë„¥ì…˜ ë§ºê³  ê¸¸ê³  ê¸´ ì½”ë“œë¡œ ê°€ì ¸ì˜¤ëŠ” ê±´ ì•„ë‹í…Œë‹ˆ ë§ì…ë‹ˆë‹¤. ğŸ¤¨

ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” JPAê°€ ë¬´ì—‡ì¸ì§€, ì™œ ë“±ì¥í–ˆëŠ”ì§€ì™€ QueryDSL ì— ëŒ€í•œ ê°„ëµí•œ ì†Œê°œë¥¼ ë‹¤ë£¹ë‹ˆë‹¤. 

## JPA(Java Persistent API)

ê´€ê³„í˜• ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ìë°” í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤.

## ì´ê²Œ ë¬´ìŠ¨ ë§ì´ë‹ˆ?

Databaseì— ì ‘ê·¼í•´ì„œ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì–»ì–´ë‚¼ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤ëŠ” ëœ»

RDBë¥¼ ê°ì²´ë¡œ ë§¤í•‘í•´ì„œ ì‚¬ìš©!


![](../img/2018-10-08/scrn 2.png){: style="width:50%; display: block; margin:100px auto 0;"}{: style="display:block;margin-top:10px;color:#828282;font-style:normal;text-align:center"}


ìœ„ì™€ ê°™ì€ RDBë¥¼ 
```java
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.GenerationType;
import javax.persistence.Id;

@Entity
public class Member {
    
    @Id
    @GeneratedValue(strategy=GenerationType.AUTO)
    private long id;
    
    @Column
    private String name;
    
    @Column
    private int age;
    
    public Member() {}
    
    public Member(String name, int age) {
        this.name = name;
        this.age = age;
    }

    // getter, setter , to String ìƒëµ
}
```
    

ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¸Œì íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ 
```java
Member m = new Member("ì¤€í‚´", 25");
```
ì²˜ëŸ¼, ìë°”ì½”ë“œì—ì„œ DBì— ê¸°ë¡ëœ ì •ë³´ë¥¼ ììœ ë¡­ê²Œ ì“¸ ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤ëŠ” ëœ»! 

## ì´ì „ì—ëŠ” ì–´ë–»ê²Œ í–ˆëŠ”ë°?

### JDBC

1. DB connection ì„ ë§ºëŠ”ë‹¤.
2. ì¿¼ë¦¬ë¥¼ ìƒì„±í•œë‹¤.

    String query = "select id, name, password from User where id = " + user.getId();

3. ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.

    ResultSet rs = stmt.executeQuery(selectQuery);

4. ì˜¤ë¸Œì íŠ¸ì— ì¼ì¼íˆ ë°ì´í„° ë§¤í•‘

    user.setId(rs.getInt("id");
    user.setName(rs.getString("name");

5. DB Connectionì„ ì¢…ë£Œí•œë‹¤. 

ì´ëŸ° ë°©ì‹ì€ SQL injectionì˜ ìœ„í—˜ ë“± ë³´ì•ˆ ë¬¸ì œê°€ ìˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì˜ user id ì— id ë¿ ì•„ë‹ˆë¼ ì›í•˜ëŠ” ì¿¼ë¦¬ë¬¸ì„ ë„£ìœ¼ë©´, í•´ë‹¹ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ë¹¼ë‚¼ ìˆ˜ ìˆë‹¤.

ë”ë¶ˆì–´ Connection ì„ ë§ºê³  ëŠìŒì— ìˆì–´ì„œ, ì˜ˆì™¸ì²˜ë¦¬ ê´€ë ¨ ì½”ë“œê°€ ê³„ì† ë°˜ë³µì ìœ¼ë¡œ ë§ì´ ë‚˜ì˜¤ê²Œ ëœë‹¤. 

### MyBatis (ë¡œ ëŒ€í‘œë˜ëŠ” SQL Mapper)

iBatis, MyBatis ë¡œ ëŒ€í‘œë˜ëŠ” SQL Mapper ë“¤ì€  `Query ì™€ ë°ì´í„°ì˜ íŒ¨ëŸ¬ë‹¤ì„` ì´ë‹¤.

ì´ëŸ¬í•œ SQL ë“¤ì€ ë³„ë„ì˜ XML íŒŒì¼ë¡œ ì—°ê²°ë˜ë©° íŒŒë¼ë¯¸í„°ì™€ ì‹¤ì œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì‹ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
```xml
<insert id="insert" parameterType="User">
    insert into User(id,name,age) values (#{id},#{name},#{age})
</insert>
```
JDBCì— ë¹„í•´ì„œ 

- Connectionì„ ë§ºëŠ” ì‘ì—…(#1), Connection Close ì‘ì—…(#5)ë¥¼ ì•Œì•„ì„œ í•´ì¤Œ
- íŒŒë¼ë¯¸í„° ë§¤í•‘ê³¼ ë°ì´í„° ë§¤í•‘ë„ ìœ„ì„

**í•˜ì§€ë§Œ**

- ì—¬ì „íˆ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼í•¨.

ë‹¤ë§Œ MyBatis ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì ë•Œë¬¸ì— ë³µì¡í•˜ê²Œ ì¿¼ë¦¬ë¥¼ ë‚ ë ¤ì„œ ë¡œê¹…í•˜ëŠ” ê²½ìš° ìœ ìš©í•˜ë‹¤.

## ê·¸ëŸ¼ ORM â†’ JPAëŠ”

ORM ì€ Tableì´ë‚˜ query ê°€ ì•„ë‹Œ ê°ì²´ ì¤‘ì‹¬ì˜ ì‚¬ê³ ë¥¼ í•´ë³´ì! í•˜ê³  ë“±ì¥í•œ ì¡´ì¬ì´ë‹¤.

Connection ë§ºê¸° / ëŠê¸° ìœ„ì„
ì¿¼ë¦¬ë¥¼ ìë™ ìƒì„± ì‹¤í–‰! ( Query Method) íŒŒë¼ë¯¸í„° ë§¤í•‘ê³¼ ë°ì´í„° ë§¤í•‘ì€ í•„ìš”ë„ ì—†ìŒ

ëª¨ë“  Domainì€ ë³€ê²½ì‚¬í•­ì´ ìˆë‹¤.

ì´ë•Œ ì½”ë“œê°€ ì§§ì•„ ë³€ê²½ì‚¬í•­ì´ ì ê³  type-safe í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤ëŠ” í° ì¥ì ì´ ìˆìŒ

## ì˜ì† / ì¤€ì˜ì† / ë¹„ì˜ì†

ë§ì´ ë„ˆë¬´ ì–´ë µë‹¤! 

ì½”ë“œë¡œ ë³´ì
```java
// ë¹„ ì˜ì† ìƒíƒœ 
    User user = new User("ì¤€ì˜", 25);
  
// ì˜ì†ìƒíƒœ
// 1ì°¨ë¡œ ìºì‹œì— ì €ì¥ëœ ìƒíƒœ
em.persist(User);

// ì¤€ì˜ì†ìƒíƒœ
// ì €ì¥ì†Œì— SQL ì¿¼ë¦¬ê°€ ì ìš©ë¨.
// ìºì‹œì—ì„œ ë–¨ì–´ì ¸ë‚˜ê°(Detached)
em.getTransaction().commit();
em.close();
```

ì¦‰ `ë¹„ì˜ì†ìƒíƒœ`ëŠ” ê°ì²´ê°€ ë§Œë“¤ì–´ì§€ê¸°ë§Œ í•˜ê³  ì–´ë””ì—ë„ ì €ì¥ë˜ì§€ ì•Šì€ ìƒíƒœ

`ì˜ì†ìƒíƒœ` ëŠ” `persist` ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ 1ì°¨ë¡œ ìºì‹œì— ì €ì¥ëœ ìƒíƒœ

`ì¤€ì˜ì†ìƒíƒœ` ëŠ” `close` ì‹œì ì—ì„œ ì €ì¥ì†Œì— SQL ì¿¼ë¦¬ê°€ ë°˜ì˜ë˜ì–´, ë” ì´ìƒ ìºì‹œì—ì„œ ë‹¤ë£°ìˆ˜ëŠ” ì—†ëŠ” ìƒíƒœ ë¥¼ ì˜ë¯¸í•¨. `Detached` ë¼ëŠ” ë§ì´ ë”ìš± ì–´ìš¸ë¦´ ë“¯í•¨.

## JPA ì†Œê°œ
```java
@Entity
@Table(name= "User")
public class User{
    
        @Id
        @GeneratedValue
        private Long id;
    
        @column(name="name", nullable=false)
        private String name;

        @column(name="email", nullable=false)
        private String email;
}
```

- `@Entity`  : Beanê°ì²´ì„ì„ ì˜ë¯¸í•œë‹¤
- `@Table` : ë§¤í•‘ë˜ëŠ” í…Œì´ë¸” ì´ë¦„ì„ ì§€ì •
- `@Id` : ì´ í…Œì´ë¸”ì˜ Idì„ì„ ë§í•¨. `@GeneratedValue` ëŠ” ìë™ìœ¼ë¡œ ìƒì„±ë¨
- `@Column` : íŠ¹ë³„íˆ columnì˜ ì†ì„±ì„ ì§€ì •í•´ì£¼ê³  ì‹¶ê±°ë‚˜ ì´ë¦„ì„ ì •í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©. ë””í´íŠ¸ë¡œëŠ” ë©¤ë²„ ë³€ìˆ˜ëª…ê³¼ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¹¼ëŸ¼ì„ ë§¤í•‘í•©ë‹ˆë‹¤.

### Repository Interface

Repository ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ìŒì²˜ëŸ¼ ì‚¬ìš©í•œë‹¤.
```java
 public interface UserRepository extends JpaRepository<User, Long>{
    // JpaRepository<ì‚¬ìš©í• Classëª…,í•´ë‹¹í´ë˜ìŠ¤ì˜primaryKey íƒ€ì…> ì„ ìƒì†
    }
```

Repository ë¥¼ êµ¬í˜„í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ ê¸°ëŠ¥ë“¤ì„ 

- Save(T)
- Delete(Y)
- FindAll()
- FindByID()

ì¶”ê°€ ì„¤ì •ì´ë‚˜ ì½”ë“œ ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

CRUD ì™¸ì— ë‹¤ë¥¸ ì½”ë“œê°€ í•„ìš”í•˜ë‹¤ë©´ ì¶”ê°€í•˜ë©´ ëœë‹¤. 
```java
public interface UserRepository extends DomainEntityRepository<Long, User> {
    
        Optional<User> findById(Long Id);
    		List<User>  findByNameAndEmail(String name, String email);
}
```
    

[ì°¸ê³  - Spring Data JPA Reference Documentation](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation)

ìœ„ ë§í¬ë¥¼ ì°¸ì¡°í•˜ë©´ ë©”ì†Œë“œ ì´ë¦„ ë§Œìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆìŒì„ ì•Œìˆ˜ìˆë‹¤. 

ì´ë¥¼ **QueryMethod** ë¼ê³  í•œë‹¤. ì •í™•íˆëŠ” JPQL ì´ë¼ëŠ” ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ë‚¸ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, Nameê³¼ emailë¡œ ìœ ì €ë¥¼ Selectí•˜ëŠ” ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ê³  ì‹¶ë‹¤ë©´ ì •í•´ì§„ ë£°ì— ë”°ë¼ 

`findBy + Name + And + Email` ì´ë¼ëŠ” ì´ë¦„ì˜ ë©”ì†Œë“œë¥¼ ë§Œë“¤ê¸°ë§Œ í•˜ë©´ ì›í•˜ëŠ” ì¿¼ë¦¬ê°€ ë§Œë“¤ì–´ì§„ë‹¤.

ë¬¼ë¡  ë”°ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ë„ ìˆë‹¤. 
```java
@Query("select t from User t where name:=name")
List<User> findByNameSQL(@Param("name" String name);
```

ì´ë ‡ê²Œ Repository ë¥¼ êµ¬ì„±í•˜ê³  ì‚¬ìš©í•˜ë©´ëœë‹¤.
```java 
@Service 
public class UserService{
        @Autowired
        private final UserRepository userRepository;

        public List<User> emailUsers(String email){
            List<User> users = userRepository.findByEmail(email);
            return users;
        }
}
``` 

ì•„ë˜ì™€ ê°™ì´ UserRepository ë¥¼ `@Autowired` annotationìœ¼ë¡œ ì£¼ì…í•´ì¤€ë‹¤.

## JQPLì„ ë³´ì™„í•˜ëŠ” QueryDSL

JPAì—ì„œ ì‚¬ìš©í•˜ëŠ” JQPL ì§ˆì˜ì–¸ì–´ëŠ” Stringì„ ì‚¬ìš©í•˜ê¸°ë•Œë¬¸ì— initial timeì— ì˜¤ë¥˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤. 

runtimeì— ë¹„í•˜ë©´ ë‚˜ì˜ì§€ ì•Šì§€ë§Œ, compile íƒ€ì„ì— ì—ëŸ¬ë¥¼ ì¡ê³ ì‹¶ì—ˆë‹¤.

ì´ë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ ê²ƒì´ QueryDSLì´ë‹¤.

QueryDSLì€ ë³„ë„ì˜ Q ê°ì²´ë¥¼ ì‚¬ìš©í•˜ë©°, ì»´íŒŒì¼ íƒ€ì„ì— ì¿¼ë¦¬ ì—ëŸ¬ë¥¼ ì¡ì„ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆì–´ì„œ

í˜„ì—…ì—ì„œ JPAì™€ í•¨ê»˜ ì“°ëŠ” ì¶”ì„¸ì´ë‹¤. 